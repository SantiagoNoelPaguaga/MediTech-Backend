extends ../layout
include ../mixin/title.pug
include ../mixin/modal.pug

block head
  link(rel="stylesheet" href="/stylesheets/tarea/forms-tarea.css")

block content
  +SectionTitle('EDITAR TAREA')

  form#formEditarTarea(action=`/tareas/edit/${tarea._id}` method="POST")
    input(type="hidden" name="_method" value="PUT")

    if user.rol === "Administrador"
      .dni-busqueda
        label(for="dniEmpleado") DNI del Empleado
        .input-group
          input#dniEmpleado(type="text" name="dniEmpleado" value=(tarea.dniEmpleado || ''))
          button#btnBuscarEmpleado(type="button") Buscar

      #infoEmpleado.card(style="display:none;")
        h4 Información del Empleado
        p
          strong Nombre:
          span#nombreEmpleado
        p
          strong Apellido:
          span#apellidoEmpleado
        p
          strong Rol:
          span#rolEmpleado
        p
          strong Área:
          span#areaEmpleado

        input#empleadoHidden(type="hidden" name="empleado" value=tarea.empleado)
        input#areaHidden(type="hidden" name="area" value=tarea.area)

      label(for="proveedor") Proveedor
      select#proveedor(name="proveedor")
        each proveedor in proveedores
          option(value=proveedor selected=(proveedor === tarea.proveedor))= proveedor

      label(for="titulo") Título
      select#titulo(name="titulo")
        option(value="" disabled) Seleccione un título

      label(for="descripcion") Descripción
      textarea#descripcion(name="descripcion" rows="3")= tarea.descripcion

      label(for="prioridad") Prioridad
      select#prioridad(name="prioridad")
        each p in ["BAJA","MEDIA","ALTA"]
          option(value=p selected=(tarea.prioridad === p))= p

      label(for="fechaInicio") Fecha de inicio
      input#fechaInicio(type="date" name="fechaInicio" value=(tarea.fechaInicio ? tarea.fechaInicio.split('T')[0] : ''))

      label(for="fechaFin") Fecha de fin
      input#fechaFin(type="date" name="fechaFin" value=(tarea.fechaFin ? tarea.fechaFin.split('T')[0] : ''))

    label(for="estado") Estado
    select#estado(name="estado")
      each e in ["PENDIENTE","EN CURSO","COMPLETADA","CANCELADA"]
        option(value=e selected=(tarea.estado === e))= e

    label(for="observaciones") Observaciones
    textarea#observaciones(name="observaciones" rows="3")= tarea.observaciones

    button(type="submit") Actualizar Tarea

block scripts
  script.
    window.TITULOS_POR_AREA = !{JSON.stringify(titulosPorArea || {})};
    window.formData = !{JSON.stringify(tarea || {})};
  script(src="/javascripts/tarea/editarTarea.js")
