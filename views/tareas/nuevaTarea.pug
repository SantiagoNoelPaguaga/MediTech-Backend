extends ../layout

block contenido
  .container
    .row.justify-content-center
      .col-md-8
        h2.text-center.mb-4 Crear Nueva Tarea

        if mensajeError
          .alert.alert-danger(role="alert")= mensajeError

        form(method="POST", action="/tareas/nueva")
          .mb-3
            label.form-label(for="area") Área:
            select.form-select(name="area", id="areaSelect", required)
              each a, index in areas
                if index === 0
                  option(value=a, selected)= a
                else
                  option(value=a)= a

          .mb-3
            label.form-label(for="titulo") Título de la Tarea:
            select.form-select(name="titulo", id="tituloSelect", required)
          
          .mb-3
            label.form-label(for="documentoEmpleado") Documento del Empleado:
            input.form-control(type="text", name="documentoEmpleado", placeholder="Ingrese Documento del empleado", required)

          .mb-3
            label.form-label(for="paciente") Documento del Paciente:
            input.form-control(type="text", name="paciente", id="pacienteInput", placeholder="Ingrese Documento del paciente")

          .mb-3
            label.form-label(for="proveedor") Proveedor:
            input.form-control(type="text", name="proveedor", id="proveedorInput", placeholder="Ingrese el nombre del proveedor")

          .mb-3
            label.form-label(for="estado") Estado:
            select.form-select(name="estado")
              option(value="pendiente") Pendiente
              option(value="en proceso") En Proceso
              option(value="completada") Finalizada

          .mb-3
            label.form-label(for="prioridad") Prioridad:
            select.form-select(name="prioridad")
              option(value="baja") Baja
              option(value="media") Media
              option(value="alta") Alta

          .mb-3
            label.form-label(for="fechaInicio") Fecha Inicio:
            input.form-control(type="date", name="fechaInicio")

          .mb-3
            label.form-label(for="fechaFin") Fecha Fin:
            input.form-control(type="date", name="fechaFin")

          .mb-3
            label.form-label(for="observaciones") Observaciones:
            textarea.form-control(name="observaciones", rows="3")

          .text-center.mb-4
            button.btn.btn-success(type="submit") Guardar

  script.
    const tareasPosibles = !{JSON.stringify(tareasPosibles)};
    const areaSelect = document.getElementById('areaSelect');
    const tituloSelect = document.getElementById('tituloSelect');
    const pacienteInput = document.getElementById('pacienteInput');
    const proveedorInput = document.getElementById('proveedorInput');

    function actualizarTitulos() {
      const area = areaSelect.value;
      const titulos = tareasPosibles[area] || [];

      tituloSelect.innerHTML = '';
      titulos.forEach((t, index) => {
        const option = document.createElement('option');
        option.value = t;
        option.textContent = t;
        if(index === 0) option.selected = true; 
        tituloSelect.appendChild(option);
      });

      if (["Administración de Turnos", "Atención Médica", "Facturación"].includes(area)) {
        pacienteInput.disabled = false;
        proveedorInput.disabled = true;
        proveedorInput.value = '';
      } else if (area === "Gestión de Insumos Médicos") {
        pacienteInput.disabled = true;
        pacienteInput.value = '';
        proveedorInput.disabled = false;
      } else {
        pacienteInput.disabled = false;
        proveedorInput.disabled = false;
      }
    }

    areaSelect.addEventListener('change', actualizarTitulos);
    window.addEventListener('DOMContentLoaded', actualizarTitulos);
